<!DOCTYPE html>
<html>
  <head>
    <title>Swarm & Traefik</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="css/main.css">
  </head>
  <body>
    <textarea id="source">


background-image: url(./img/devops.png)
background-size: 150%

---

class: middle
background-image: url(./img/kuzzle.png)
background-position: 90% 50% 
background-size: 40%

# Kuzzle

* Open Source & on-premise
* Cluster mode
* HTTP, MQTT & WebSocket support
* Under Apache 2.0 license


---
name: begin
class: top center
background-image: url(./img/swarm+gopher.png)
background-position: 50% 75% 

# Swarm & Traefik
## ...how to build a scalable prod without ruining yourself

---

class: middle center

# A bit of context...

---

background-image: url(./img/orchestrators.jpg)

# Orchestrators

---

class: middle
background-image: url(./img/swarm.png)
background-position: 90% 50% 
background-size: 40%

# Docker Swarm

* Developed by Docker Inc.
* Shipped with Docker Engine
* Docker Compose file syntax
* Docker secrets and configs
* Under Apache 2.0 license

---

# Docker Swarm: Cluster creation

First manager node creation

~~~rust
docker swarm init
~~~

Add a new worker node

~~~rust
docker swarm join --token SWARM_CLUSTER_TOKEN MANAGER_IP:2377
~~~

Add a new manager node
~~~rust
docker swarm join-token manager
~~~

---

~~~yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kibana-logging
  namespace: kube-system
  labels:
    k8s-app: kibana-logging
    addonmanager.kubernetes.io/mode: Reconcile
spec:
  replicas: 1
  selector:
    matchLabels:
      k8s-app: kibana-logging
  template:
    metadata:
      labels:
        k8s-app: kibana-logging
      annotations:
        seccomp.security.alpha.kubernetes.io/pod: 'docker/default'
    spec:
      containers:
      - name: kibana-logging
        image: docker.elastic.co/kibana/kibana-oss:7.2.0
    ...
~~~
---

background-color: black
background-image: url(./img/wtf.jpg)

---

# Docker Swarm: Stack configuration

`kibana.yml`
~~~yaml
version: '3.7'
services:
  kibana:
    image: docker.elastic.co/kibana/kibana-oss:7.2.0
    environment:
      SERVER_NAME: kibana.example.org
      ELASTICSEARCH_HOSTS: http://elasticsearch.example.org
    deploy:
      replicas: 1
      restart_policy:
        condition: 'on-failure'
~~~

Deployment using Docker CLI

~~~rust
$ docker stack deploy -c kibana.yml kibana
~~~

---

background-image: url(./img/deployment.gif)
background-size: 90%
background-color: black

---

class: middle
background-image: url(./img/facepalm.png)
background-position: 80% 50% 
background-size: 40%

# Missing a router...

---

class: middle
background-image: url(./img/traefik.png)
background-position: 90% 50% 
background-size: 40%

# Traefik

* Developed by Containous
* HTTP/TCP proxy made for container
* HTTPS certificates with Let's Encrypt
* Under MIT license

---
# Traefik: Installation and configuration

Use binary release and give arguments to the launching command...
~~~toml
traefik --providers.docker=true \
  --providers.docker.endpoint=unix:///var/run/docker.sock \
  --providers.docker.swarmmode=true \
  --providers.docker.exposedbydefault=false \
  --providers.docker.network=traefik-network \
  --entrypoints.web.address=:80 \
  --entrypoints.websecure.address=:443"
~~~

...or use a classical config file

~~~toml
traefik --configFile=foo/bar/myconfigfile.toml
~~~

...or the docker image
~~~toml
docker run -d -p 80:80 \
    -v $PWD/traefik.toml:/etc/traefik/traefik.toml traefik:v2.0
~~~

---

# Traefik: Service routing

~~~yaml
version: '3.7'
networks:
  traefik-network:
    external: true
services:
  kibana:
    image: docker.elastic.co/kibana/kibana-oss:7.2.0
    environment:
      SERVER_NAME: kibana.example.com
      ELASTICSEARCH_HOSTS: http://elasticsearch.example.org
    networks:
      - traefik-network
    deploy:
      replicas: 1
      restart_policy:
        condition: 'on-failure'
      labels:
        traefik.enable: "true"
        traefik.http.routers.kibana.rule: "Host(`kibana.example.com`)"
        traefik.http.routers.kibana.entrypoints: "web"
        traefik.http.services.kibana-svc.loadbalancer.server.port: 5601
~~~
---

background-image: url(./img/magic.gif)
background-size: 90%
background-color: black

---

background-image: url(./img/quickstart-diagram.png)
background-size: 70%
background-position: 75% 75% 

# Traefik: How it works?

---

background-color: black
background-image: url(./img/demo.gif)

<h1 style="color: white;">Let's play!</h1>

---

background-size: 450px 450px

# Get the slides and more...

<img id="slides-qr" src="./img/slides-qr.svg"/>

.center[https://github.com/alexandrebouthinon/Swarm-and-Traefik]
---

class: center
background-color: black
background-size: 60%
background-position: 50% 80%
background-image: url(./img/thanks.gif)

<h1 style="color: white;">Thank you!</h1>



    </textarea>
    <script src="js/vendors/remark-latest.min.js"></script>
    <script src="js/index.js"></script>
  </body>
</html>
